## [Development and validation of an explainable machine learning model for predicting postoperative pulmonary complications after lung cancer surgery: a machine learning study](https://www.thelancet.com/journals/eclinm/article/PIIS2589-5370(25)00318-9/fulltext)

这篇研究使用了两组独立的数据集来构建和验证机器学习模型，其数据来源、构建过程和筛选方法都非常系统严谨。以下是详细的数据构建情况：

📊 一、数据来源与队列设计

研究采用了双向病例对照设计，数据来源于遵义医科大学附属医院胸外科的患者，分为两个独立且不重叠的队列：

1.  模型开发与内部验证队列（回顾性队列）
    ◦   时间范围：2022年1月1日至2023年10月31日。

    ◦   样本量：共纳入 883名 接受肺癌手术的患者。

    ◦   结局指标：术后肺部并发症（PPCs）的发生率为 35.4%（313例）。

2.  前瞻性验证队列
    ◦   时间范围：2023年11月1日至2024年7月31日。

    ◦   样本量：共纳入 308名 患者。

    ◦   结局指标：PPCs的发生率为 29.5%（91例）。

🔍 二、数据收集与变量筛选流程

变量的选择并非随意而定，而是通过一个多步骤、证据驱动的严谨流程最终确定，具体步骤如下：

1.  初始变量池构建：通过系统文献回顾和Meta分析，初步确定了46个潜在风险因素。
2.  专家共识修正：通过两轮德尔菲法（Delphi） 咨询了15位拥有超过10年临床经验的护理专家和胸外科副主任医师，对变量池进行丰富和评估。
3.  最终候选变量：经过以上步骤，最终确定了 67个候选变量，并将其分为8大类：
    ◦   人口统计学资料

    ◦   合并症情况

    ◦   血常规指标

    ◦   凝血参数

    ◦   代谢组指标

    ◦   肺功能指标

    ◦   其他术前检查

    ◦   术中指标

⚙️ 三、数据预处理与特征工程

为了保证数据质量，研究人员进行了以下预处理工作：

•   数据清洗与编码：对文本描述进行数值化转换（如性别：女=0，男=1）。

•   缺失值处理：对于缺失数据，连续变量采用期望最大化（EM）算法填充，二分类变量用众数填充，有序变量用中位数填充。总体数据缺失超过20%的患者会被剔除。

•   处理类别不平衡：由于PPCs组（阳性）与非PPCs组（阴性）比例为1:1.82，存在类别不平衡问题。研究采用 SMOTETomek 方法对训练集进行重采样，该方法是SMOTE和Tomek Links的结合，既能增加少数类样本，又能清除多数类中的噪声样本，有效提升了模型在少数类上的识别能力。

📉 四、最终用于模型构建的特征

经过严格的筛选（包括单因素分析、共线性分析、9种机器学习算法的重要性排序、递归特征消除-RFE以及专家最终评审），最终确定了9个最关键的特征用于所有机器学习模型的构建：

特征类别 具体特征

患者基本信息 年龄 (Age)

体重指数 (BMI)

吸烟年限 (Years of Smoking)

健康状况 Charlson合并症指数 (CCI)

红细胞分布宽度变异系数 (RDW-CV, %)

肿瘤情况 肿瘤分期 (Tumour Stage)

肺功能指标 一氧化碳弥散量 (DLCO, mmol/min/kPa)

手术相关指标 手术时长 (Duration of Surgery)

术中输液量 (Intraoperative Fluid Infusion Volume, IFIV, mL)

🤖 五、数据集划分与模型构建

•   回顾性队列（883例） 被随机按 8:2 的比例分割：

    ◦   训练集 (Training Set)：706例，用于训练模型和参数调优。

    ◦   内部验证集 (Internal Validation Set)：177例，用于初步评估模型性能，防止过拟合。

•   前瞻性队列（308例） 作为外部验证集 (Prospective Validation Set)，用于最终检验模型的泛化能力和临床实用性。

研究使用这些数据共构建了 12种独立的机器学习模型（如梯度提升树GBDT、随机森林RF、逻辑回归等）和 26种堆叠集成模型（Stacking Ensemble Models），以期找到预测性能最佳的模型。



💎 总结

总而言之，这项研究构建模型的数据基础非常坚实，其特点可以概括为：
•   来源清晰：来自单一中心的回顾性与前瞻性双队列。

•   流程严谨：变量筛选结合了文献证据、多种算法和专家经验。

•   处理规范：对缺失值、类别不平衡等常见数据问题进行了妥善处理。

•   特征明确：最终确定了9个具有临床意义的预测特征。

•   验证充分：不仅进行了内部验证，还进行了前瞻性的外部验证，极大增强了模型结果的可信度。

这种系统性的数据处理方法确保了所开发机器学习模型的准确性和可靠性。

